"use strict";var app=angular.module("app",["ngResource"]).config(function(e,n,r){var t=function(e,n,r,t,o){var s=e.defer();return r.get("/loggedin").success(function(e){"0"!==e?n(s.resolve,0):(o.message="You need to log in.",n(function(){s.reject()},0),t.url("/login"))}),s.promise};r.responseInterceptors.push(function(e,n){return function(r){return r.then(function(e){return e},function(r){return 401===r.status&&n.url("/login"),e.reject(r)})}}),e.when("/",{templateUrl:"/views/main.html"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl",resolve:{loggedin:t}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}).run(function(e,n){e.message="",e.logout=function(){e.message="Logged out.",n.post("/logout")}});app.controller("LoginCtrl",function(e,n,r,t){e.user={},e.login=function(){r.post("/login",{username:e.user.username,password:e.user.password}).success(function(){n.message="Authentication successful!",t.url("/admin")}).error(function(){n.message="Authentication failed.",t.url("/login")})}}),app.controller("AdminCtrl",function(e,n){e.users=[],n.get("/users").success(function(n){for(var r in n)e.users.push(n[r])})});